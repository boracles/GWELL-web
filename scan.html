<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì¥ë‚´ìì‚° ìŠ¤ìº” â€” Scan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/css/style.css" />

    <!-- Supabase UMD -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
    <script src="assets/js/supabase-init.js"></script>
    <script src="assets/js/scan.js" defer></script>
    <style>
      /* ì´ í˜ì´ì§€ ì „ìš© ì•½ê°„ì˜ ì¶”ê°€ ìŠ¤íƒ€ì¼ (í•„ìš”í•˜ë©´ style.cssë¡œ ì˜®ê²¨ë„ ë¨) */
      .scan-root {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 12px 16px 20px;
        gap: 12px;
      }

      .scan-main {
        flex: 1;
        display: flex;
        flex-direction: column;

        /* ì•ˆìª½ ë‚¨ìƒ‰ íŒ¨ë„ ì œê±° â†’ ë°”ê¹¥ .app ë°°ê²½ê³¼ í•˜ë‚˜ë¡œ ë³´ì´ê²Œ */
        background: transparent;
        border-radius: 0;
        border: none;

        padding: 16px 16px 18px;
        position: relative;
        overflow: hidden;
      }

      .scan-bg {
        position: absolute;
        inset: 0;
        opacity: 0.3;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .scan-bg.particles {
        background: radial-gradient(
          circle at center,
          rgba(57, 20, 107, 0.85) 0%,
          /* #39146B ê¸°ë°˜ */ transparent 60%
        );
      }

      .scan-bg.spiral {
        background: radial-gradient(
          circle at center,
          #a855f7 0,
          transparent 50%
        );
      }

      .scan-bg.noise {
        background: radial-gradient(
          circle at center,
          #f97316 0,
          transparent 60%
        );
      }

      .scan-content {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .scan-top-row {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        align-items: flex-start;
      }

      .scan-status-block {
        font-size: 11px;
        opacity: 0.82;
      }

      .scan-status-block span.label {
        opacity: 0.7;
      }

      .scan-status-block span.val {
        font-variant-numeric: tabular-nums;
        margin-left: 4px;
      }

      .scan-main-message {
        margin-top: 12px;
      }

      .scan-main-message h2 {
        margin: 0 0 6px;
        font-size: 18px;
      }

      .scan-main-message p {
        margin: 0;
        font-size: 13px;
        opacity: 0.9;
      }

      .scan-secondary {
        margin-top: 6px;
        font-size: 12px;
        opacity: 0.82;
      }

      .scan-bottom {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .scan-progress-row {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        opacity: 0.85;
      }

      .scan-progress-bar {
        width: 100%;
        height: 6px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        overflow: hidden;
      }

      .scan-progress-bar-inner {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #22c55e, #a855f7, #38bdf8);
        transition: width 0.3s ease;
      }

      .scan-purity-row {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        opacity: 0.9;
      }

      .scan-buttons-row {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 4px;
      }

      .scan-btn-ghost {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: transparent;
        color: #e5e7eb;
        font-size: 12px;
      }

      .scan-btn-primary {
        padding: 6px 14px;
        border-radius: 999px;
        border: none;
        background: #6d5dfc;
        color: #fff;
        font-size: 12px;
        font-weight: 600;
      }

      .scan-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        font-size: 10px;
        opacity: 0.8;
      }

      .scan-warning {
        margin-top: 4px;
        font-size: 11px;
        color: #f97373;
      }

      .scan-result-list {
        margin-top: 6px;
        font-size: 12px;
        opacity: 0.9;
      }

      .scan-result-list div {
        margin-bottom: 2px;
      }

      .scan-debug-row {
        margin-top: 8px;
        font-size: 10px;
        opacity: 0.6;
      }

      /* ì„¼ì„œ ì‹œë®¬ë ˆì´í„° ë²„íŠ¼ (ì‹¤ì œ ì„¤ì¹˜ì—ì„œëŠ” ìˆ¨ê²¨ë„ ë¨) */
      .sensor-sim {
        margin-top: 8px;
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }

      .sensor-sim button {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
      }

      /* ë””ë²„ê·¸ UI ì „ë¶€ ìˆ¨ê¸°ê¸° */
      #debugStartBtn {
        display: none;
      }
      .sensor-sim {
        display: none;
      }
      .scan-debug-row {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="app app--scan">
      <!-- Standby í™”ë©´: íŒŒí‹°í´ + íŒíŠ¸ í•œ ì¤„ -->
      <div id="standbyScreen" class="standby-screen">
        <div class="standby-bg"></div>
        <canvas id="standbyParticles"></canvas>
        <div class="standby-center">
          <div class="standby-hint" id="standbyHint">
            ì°©ì„ ì‹œ ìŠ¤ìº” ì ˆì°¨ê°€ ì‹œì‘ë©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <!-- ì‹¤ì œ ìŠ¤ìº” UI í—¤ë” (ì´ê²Œ scanHeader) -->
      <header class="app-header" id="scanHeader">
        <div class="app-header__titles">
          <h1 class="app-title">ì¥ë‚´ìì‚° ìŠ¤ìº”</h1>
          <p class="app-subtitle">
            ë³€ê¸°ì— ì•‰ëŠ” ìˆœê°„, ì¥ë‚´ ë°ì´í„°ê°€ ì •ì œë˜ì–´ ì‚¬íšŒì  ìì‚°ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.
          </p>
        </div>
        <!-- ì‹¤ì œ ì„¤ì¹˜ì—ì„  ìˆ¨ê²¨ë„ ë˜ëŠ” ë””ë²„ê·¸ ë²„íŠ¼ -->
        <button class="app-cta" id="debugStartBtn">ë””ë²„ê·¸: ì‹œí€€ìŠ¤ ì‹œì‘</button>
      </header>

      <!-- ìŠ¤ìº” ë©”ì¸ ì˜ì—­ (ì´ê²Œ scanRoot) -->
      <div class="scan-root" id="scanRoot">
        <div class="scan-main">
          <div class="scan-bg particles" id="scanBg"></div>

          <div class="scan-content">
            <div class="scan-posture" id="scanPosture" style="display: none">
              <!-- ì œëª© + ê³ ì • ì•ˆë‚´ ë¬¸êµ¬ (ì¸í¬ê·¸ë˜í”½ ìœ„) -->
              <div class="posture-message">ì˜¬ë°”ë¥¸ ìì„¸ë¡œ ì•‰ì•„ ì£¼ì„¸ìš”.</div>

              <div class="posture-sub posture-sub-soft" id="postureLine4">
                ì ì‹œ ë™ì•ˆ ì´ ìì„¸ë¥¼ ìœ ì§€í•˜ë©´ ìŠ¤ìº”ì´ ìë™ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.
              </div>

              <!-- ì¸í¬ê·¸ë˜í”½ -->
              <div class="posture-graphic">
                <img
                  src="assets/img/Sit.svg"
                  class="posture-img posture-img--idle"
                  id="postureImg"
                  alt="ì˜¬ë°”ë¥¸ ì°©ì„ ìì„¸ ì¸í¬ê·¸ë˜í”½"
                />
              </div>

              <!-- ğŸ”¹ ì—¬ê¸°ê°€ â€œí•œ ì¤„ì”© ë°”ë€Œì–´ ë‚˜ì˜¤ëŠ”â€ ìë¦¬ (í•˜ë‚˜ë§Œ) -->
              <div class="posture-sub posture-line" id="postureSequenceText">
                <!-- JSì—ì„œ ë¬¸ì¥ êµì²´í•¨ -->
              </div>

              <div class="posture-stepper">
                <div class="posture-progress-bar">
                  <div
                    class="posture-progress-bar-inner"
                    id="postureProgressInner"
                  ></div>
                </div>
                <div class="posture-stepper-dots">
                  <!-- ğŸ”¹ ì‹œì‘ ì§€ì : ê³µê°„ë§Œ ì°¨ì§€, ì‹¤ì œ ë‹¨ê³„ ì•„ë‹˜ -->
                  <div class="posture-step posture-step--start">
                    <span class="posture-step-dot"></span>
                  </div>

                  <!-- ğŸ”¹ 1ë‹¨ê³„ -->
                  <div class="posture-step" data-step="0">
                    <span class="posture-step-dot"></span>
                    <span class="posture-step-check">âœ”</span>
                  </div>

                  <!-- ğŸ”¹ 2ë‹¨ê³„ -->
                  <div class="posture-step" data-step="1">
                    <span class="posture-step-dot"></span>
                    <span class="posture-step-check">âœ”</span>
                  </div>

                  <!-- ğŸ”¹ 3ë‹¨ê³„ -->
                  <div class="posture-step" data-step="2">
                    <span class="posture-step-dot"></span>
                    <span class="posture-step-check">âœ”</span>
                  </div>

                  <!-- ğŸ”¹ 4ë‹¨ê³„ -->
                  <div class="posture-step" data-step="3">
                    <span class="posture-step-dot"></span>
                    <span class="posture-step-check">âœ”</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- ìƒë‹¨ ìƒíƒœ ë¸”ëŸ­ -->
            <div class="scan-top-row" id="scanTopRow">
              <div class="scan-status-block">
                <div>
                  <span class="label">PIR:</span>
                  <span class="val" id="statusPir">OFF</span>
                </div>
                <div>
                  <span class="label">Pressure:</span>
                  <span class="val" id="statusPressure">OFF</span>
                </div>
                <div>
                  <span class="label">System:</span>
                  <span class="val" id="statusSystem">IDLE</span>
                </div>
              </div>
              <div class="scan-status-block" style="text-align: right">
                <div>
                  <span class="label">Phase:</span>
                  <span class="val" id="statusPhase">A0-1</span>
                </div>
                <div>
                  <span class="label">Timer:</span>
                  <span class="val" id="statusTimer">00:00</span>
                </div>
              </div>
            </div>

            <!-- ë©”ì¸ ë©”ì‹œì§€ -->
            <div class="scan-main-message" id="scanMainMessage">
              <h2 id="mainMessage">ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.</h2>
              <p id="subMessage">
                ê´€ëŒê° ì ‘ê·¼ ì „, ì‹œìŠ¤í…œì€ ì¥ë‚´ìì‚° ìŠ¤ìº”ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤.
              </p>
              <div class="scan-secondary" id="secondaryMessage">
                ë³€ê¸° ê·¼ì²˜ì— ë‹¤ê°€ì˜¤ë©´ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ê¹¨ì–´ë‚©ë‹ˆë‹¤.
              </div>
            </div>

            <!-- ê²½ê³  / ê²°ê³¼ -->
            <div
              class="scan-warning"
              id="warningMessage"
              style="display: none"
            ></div>
            <div
              class="scan-result-list"
              id="resultList"
              style="display: none"
            ></div>

            <!-- ì„¼ì„œ ì‹œë®¬ë ˆì´í„° -->
            <div class="sensor-sim" id="sensorSim">
              <button id="btnPirOn">ì ‘ê·¼ ê°ì§€(PIR ON)</button>
              <button id="btnPirOff">PIR OFF</button>
              <button id="btnSit">ì••ë ¥ì„¼ì„œ ON(ì°©ì„)</button>
              <button id="btnStand">ì••ë ¥ì„¼ì„œ OFF(ì´íƒˆ)</button>
              <button id="btnReset">ê°•ì œ ë¦¬ì…‹</button>
            </div>

            <!-- í•˜ë‹¨: ì§„í–‰/ì •ì œìœ¨/ë²„íŠ¼ -->
            <div class="scan-bottom" id="scanBottom">
              <div class="scan-progress-row" id="progressRow">
                <div id="progressLabel">ìŠ¤ìº” ëŒ€ê¸°</div>
                <div id="progressTime">00:00 / 00:30</div>
              </div>
              <div class="scan-progress-bar" id="progressBar">
                <div
                  class="scan-progress-bar-inner"
                  id="progressBarInner"
                ></div>
              </div>

              <div class="scan-purity-row" id="purityRow">
                <div>
                  <span class="scan-tag">ì •ì œìœ¨</span>
                  <span id="purityValue">0%</span>
                </div>
                <div id="remainingTime">ë‚¨ì€ ì‹œê°„: -</div>
              </div>

              <div
                class="scan-buttons-row"
                id="decisionButtons"
                style="display: none"
              >
                <button class="scan-btn-ghost" id="btnNo">
                  NO Â· ìƒì¥í•˜ì§€ ì•Šê¸°
                </button>
                <button class="scan-btn-primary" id="btnYes">
                  YES Â· ì‚¬íšŒ ìì‚°ìœ¼ë¡œ ìƒì¥
                </button>
              </div>

              <div class="scan-debug-row" id="debugInfo">
                A0-1: Standby â†’ PIR ON(A0-2) â†’ ì••ë ¥ ON(A1) â†’ B(ìŠ¤ìº”) â†’ C(ê²°ê³¼) â†’
                YES/NO ìƒì¥.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
